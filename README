Install Anaconda or Miniconda. Read the instructions:

    https://docs.anaconda.com/anaconda/install/

Clone the repository

    $ git clone https://github.com/jlpl/nais-processor.git

Create a conda environment from the nais_processor.yml file
  
    $ cd nais-processor
    $ conda env create -f nais_processor.yml

        # nais_processor.yml

        name: nais-processor
        channels:
            - defaults
            - conda-forge
        dependencies:
            - python=3.6
            - numpy
            - matplotlib
            - pandas
            - pyyaml
            - tinydb
            - ipython
            - jq

Create a yaml configuration file. For one of the 5-series models:

    # example-config-file-nais-5-7.yml

    database_file: './nais-5-7-jfj.json'
    model: 'NAIS-5-7'
    inverter_resolution: 'high'
    sampleflow_name: 
          - 'pos_sampleflow.mean'
          - 'neg_sampleflow.mean'
    particle_files: '-block-particles.spectra'
    ion_files: '-block-ions.spectra'
    diagnostic_files: '-block.records'
    delimiter: '\t'
    temperature_name: 'temperature.mean'
    pressure_name: 'baro.mean'
    inlet_length: 0.78 # in meters
    location: 'Jungfraujoch'
    sealevel_correction: False
    data_folder: '/home/user/data/raw/'
    processed_folder: '/home/user/data/processed/'
    figure_folder: '/home/user/data/figures/'
    start_date: '1990-01-01'
    end_date: '2030-01-01'

For NAIS1, which does not measure T/P and only has one sensor for the flow rate:
    
    # example-config-file-nais1.yml

    database_file: './nais1-svalbard.json'
    model: 'NAIS1'
    inverter_resolution: 'low'
    sampleflow_name: 'Flowaer' 
    particle_files: '.particles.nds'
    ion_files: '.ions.nds'
    diagnostic_files: '.log'
    delimiter: ','
    temperature_name: ''
    pressure_name: ''
    pipe_length: 2.9 # inlet length in meters
    location: 'Svalbard'
    sealevel_correction: False
    data_folder: '/home/user/data/raw/'
    processed_folder: '/home/user/data/processed/'
    figure_folder: '/home/user/data/figures/'
    start_date: '1990-01-01'
    end_date: '2030-01-01'

Activate the nais-processor environment

    $ conda activate nais-processor

Open a python shell (or write a command file) and run the following commands

    (nais-processor)$ python
    >>> from nais_processor import *
    >>> nais_processor('/path/to/config/file/config-file.yml)
    >>> nais_plotter('/path/to/config/file/config-file.yml')

nais_processor() creates a JSON database. The database contains information on the 
processed files and figures as well as possible errors during processing. View it 
with any JSON processor. For example jq is installed with the environment.

To view the whole database, use:

    (nais-processor)$ jq . db-file.json



